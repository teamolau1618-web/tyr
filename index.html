<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cine IA - Modo Ultra</title>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        body { background: #050505; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .screen { width: 80%; max-width: 800px; aspect-ratio: 16/9; background: #000; box-shadow: 0 0 40px rgba(255,0,0,0.3); border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        .controls { margin-top: 20px; width: 80%; max-width: 800px; display: flex; gap: 10px; }
        input { flex-grow: 1; padding: 15px; border-radius: 5px; border: none; background: #1a1a1a; color: white; font-size: 1.1em; }
        button { padding: 15px 30px; background: #ff0000; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #status { margin-top: 15px; color: #888; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="screen"><div id="player"></div></div>
    <div class="controls">
        <input type="text" id="prompt" placeholder="Escribe lo que quieras ver...">
        <button onclick="buscar()">REPRODUCIR</button>
    </div>
    <div id="status">Esperando...</div>

<script>
    const GROQ_KEY = "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";
    const YT_KEY = "AQ.Ab8RN6IJfEGA4cGu1mzlpdJmLD0PN2rc3j00EH6Notue31_6iQ"; // <--- VERIFICA ESTO

    let player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', { height: '100%', width: '100%', videoId: 'dQw4w9WgXcQ' });
    }

    async function buscar() {
        const input = document.getElementById('prompt').value;
        const status = document.getElementById('status');
        if(!input) return;

        status.innerText = "ü§ñ La IA est√° decidiendo qu√© video es...";
        
        try {
            // 1. Preguntar a GROQ
            const resGroq = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${GROQ_KEY}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: "llama3-8b-8192",
                    messages: [{role: "system", content: "Responde SOLO el nombre de la canci√≥n y artista."}, {role: "user", content: input}]
                })
            });
            const dataGroq = await resGroq.json();
            const cancion = dataGroq.choices[0].message.content;
            
            status.innerText = `üîé Buscando en YouTube: ${cancion}`;

            // 2. Intentar buscar con la API de YouTube
            const resYT = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(cancion)}&type=video&key=${YT_KEY}`);
            const dataYT = await resYT.json();

            if (dataYT.items && dataYT.items.length > 0) {
                player.loadVideoById(dataYT.items[0].id.videoId);
                status.innerText = "‚úÖ ¬°Encontrado!";
            } else {
                // PLAN B: Si la API falla, te damos el link directo para no perder tiempo
                status.innerHTML = `‚ùå Error de API Key. <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(cancion)}" target="_blank" style="color:red">Haz clic aqu√≠ para ver resultados</a>`;
                console.error("Detalle del error:", dataYT);
            }
        } catch (e) {
            status.innerText = "üí• Error cr√≠tico de conexi√≥n.";
        }
    }
</script>
</body>
</html>
